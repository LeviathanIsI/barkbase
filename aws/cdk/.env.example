# ============================================================================
# BARKBASE INFRASTRUCTURE CONFIGURATION
# ============================================================================
# Copy this file to .env and fill in your values
# Do NOT commit .env to version control (it's in .gitignore)

# ============================================================================
# REQUIRED VARIABLES
# ============================================================================

# Deployment Stage: dev, staging, or prod
# Determines resource sizing, retention periods, and costs
STAGE=dev

# JWT Secret for Authentication (REQUIRED)
# Generate with: openssl rand -base64 64
# NEVER commit this to version control!
JWT_SECRET=

# Database Configuration
DB_NAME=barkbase
DB_USER=postgres

# ============================================================================
# COST OPTIMIZATION FLAGS
# ============================================================================
# These settings control optional AWS resources that incur costs
# Recommended settings vary by environment (see below)

# Enable VPC Endpoints for AWS services ($14.40/month)
# Set to 'true' ONLY if deploying Lambda functions inside VPC
# Development: false | Staging: false | Production: true
ENABLE_VPC_ENDPOINTS=false

# Enable RDS Proxy for connection pooling ($10/month)
# Provides connection pooling and failover support
# Development: false | Staging: true | Production: true
ENABLE_RDS_PROXY=false

# Deploy Lambda Functions in VPC (requires VPC endpoints or NAT Gateway)
# Increases cold start latency but provides private networking
# Development: false | Staging: false | Production: true
DEPLOY_LAMBDAS_IN_VPC=false

# ============================================================================
# MONITORING CONFIGURATION
# ============================================================================

# Email address for CloudWatch alarms and security alerts
# You'll receive notifications for:
# - RDS performance issues (CPU, storage, connections)
# - API Gateway errors and latency
# - Lambda function errors
# - Security events (failed logins, auth failures)
MONITORING_EMAIL=

# ============================================================================
# OPTIONAL - JWT SECRETS ROTATION
# ============================================================================
# For zero-downtime JWT secret rotation

# Old JWT secret (keep during rotation period)
# Leave blank if not rotating secrets
# JWT_SECRET_OLD=

# ============================================================================
# RECOMMENDED CONFIGURATIONS BY ENVIRONMENT
# ============================================================================

# ----------------------------
# DEVELOPMENT ENVIRONMENT
# ----------------------------
# Cost: ~$39.91/month
# STAGE=dev
# ENABLE_VPC_ENDPOINTS=false
# ENABLE_RDS_PROXY=false
# DEPLOY_LAMBDAS_IN_VPC=false
# MONITORING_EMAIL=dev@yourdomain.com
#
# Features:
# - Lowest cost configuration
# - Fast Lambda cold starts (no VPC)
# - 30-day log retention
# - 7-day database backups
# - t4g.micro RDS instance
# - No Multi-AZ

# ----------------------------
# STAGING ENVIRONMENT
# ----------------------------
# Cost: ~$55/month
# STAGE=staging
# ENABLE_VPC_ENDPOINTS=false
# ENABLE_RDS_PROXY=true
# DEPLOY_LAMBDAS_IN_VPC=false
# MONITORING_EMAIL=staging@yourdomain.com
#
# Features:
# - Medium cost configuration
# - RDS Proxy for testing connection pooling
# - 90-day log retention
# - 14-day database backups
# - t4g.small RDS instance
# - No Multi-AZ

# ----------------------------
# PRODUCTION ENVIRONMENT
# ----------------------------
# Cost: ~$87.72/month
# STAGE=prod
# ENABLE_VPC_ENDPOINTS=true
# ENABLE_RDS_PROXY=true
# DEPLOY_LAMBDAS_IN_VPC=true
# MONITORING_EMAIL=ops@yourdomain.com
#
# Features:
# - Production-grade configuration
# - Private networking via VPC
# - Connection pooling via RDS Proxy
# - 90-day log retention
# - 30-day database backups
# - t4g.small RDS instance
# - Multi-AZ for high availability
# - Performance Insights enabled
# - Deletion protection enabled

# ============================================================================
# DEPLOYMENT INSTRUCTIONS
# ============================================================================
# 1. Copy this file: cp .env.example .env
# 2. Generate JWT secret: openssl rand -base64 64
# 3. Update .env with your JWT_SECRET and MONITORING_EMAIL
# 4. Load environment: source .env (or set export in your shell)
# 5. Install dependencies: npm install
# 6. Review configuration: cdk synth
# 7. Deploy: cdk deploy
#
# See aws/INFRASTRUCTURE_FIXES.md for detailed documentation

# ============================================================================
# TROUBLESHOOTING
# ============================================================================
# Issue: "JWT_SECRET not set" error
# Solution: Generate and export JWT_SECRET before deployment
#
# Issue: RDS connection timeouts
# Solution: Wait 10-15 minutes for RDS instance to be ready after deployment
#
# Issue: No monitoring emails
# Solution: Check SNS subscription confirmation in your inbox/spam
#
# Issue: High costs
# Solution: Verify ENABLE_VPC_ENDPOINTS and ENABLE_RDS_PROXY are false for dev
#
# For more troubleshooting, see aws/INFRASTRUCTURE_FIXES.md

# ============================================================================
# SECURITY NOTES
# ============================================================================
# - NEVER commit .env file to version control
# - Use different JWT_SECRET for each environment
# - Rotate JWT_SECRET every 90 days
# - Use AWS Secrets Manager for production secrets (optional)
# - Enable MFA for AWS account access
# - Regularly review CloudWatch logs for suspicious activity
#
# See aws/SECURITY_DEPLOYMENT_GUIDE.md for security best practices
